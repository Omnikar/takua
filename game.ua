# Experimental!

Flat â† 1
Wall â† 2
Cap  â† 3

â”Œâ”€â•´Board
  ~ {
    # All past board states
    History
    # The current board state
    State
    # Flat stones per player
    NFlats
    # Capstones per player
    NCaps
  }
  PieceCount â† ËœâŠ[15_0 21_1 30_1 40_2 50_2]â†¥â‚€â†§â‚„-â‚„
  # Create a new Board
  # Board ? Size
  Call â† NewâŠƒ(Ëœâ†¯{}[0.]|â†¯ËœâŸœâ†¯â–¡[]|Â°âŠŸPieceCount)
  # The index of the current turn
  Turn â† â§»History
â””â”€â•´
â”Œâ”€â•´Move ~ ClickSquare
  # New move that has not been built yet
  |Uninit
  # Place a new piece on the board
  |Place {
    # The piece type to place
    Piece
    # The position to place at
    Pos
  }
  # Move existing pieces
  |Move {
    # The number of pieces to move
    Num
    # The direction to move in
    Dir
    # The amounts of pieces dropped at each step
    Amnts
    # The position the pieces are picked up from
    Orig
  }
  New â† Uninit

  SwitchPlacement â†š (
    # If already placing and clicking on the same square,
    # increment the piece type to be placed
    âœ(-â‚Â°Place
    | âŠ™Â°.
      â—¡â‹…â‹…Board!âŠƒ(State|NFlats|NCaps)
      Ëœâˆ©>âˆ©/+âŠ¸Â¬=â‚ƒâ–½âŠ¸Â±/â—‡âŠ‚â™­
      â¨¬(-â‚â‹…CapÂ°1)â¨¬(â—¿â‚‚+â‚|â—¿â‚ƒ+â‚)
    ):
  )

  PickUpPieces â†š Move!(
    # If moving and clicking on the origin square
    Â°.â—¡â‹…Orig
    # And nowhere else has been clicked already
    Â°[]â—¡â‹…Amnts
    # Min number of stones and carry limit
    ğ„âŒ(â†§â—‡âˆ©â§»âŠ¸âŠ¡âŠ™âŠ¸Board~State)
    # Increment the number of stones being
    # carried and limit accordingly
    âœNum(â†§+â‚)
  )

  MovePieces â†š Move!(
    â—¡â‹…Dir

    TryMove â† (
      âŠ¡âŠ™â—¡â‹…Board~State
      # Ensure that the piece being moved
      # onto is not a capstone
      Â°1âŠ¸<CapâŒµâ—‡â¬š1âŠ¢
      # If it is a wall, ensure the piece
      # being moved is a lone capstone
      >Flat
      â¥(Â°1-/+âŠ¸âŠƒAmnts Num
        Â°Capâ—‡âŠ¢âŠ¡â—¡âŠ“Orig Board~State)

      âœAmnts(âŠ‚1)
    )

    â£(â—¡â‹…Orig Â°0_0
      ğ„âŒÂ°âŠ¸Dir â©Â°1âŠ¸âˆŠAâ‚‚âŠ¸-
      TryMove
    | âŠ™(âŠ¸-+Ã—â§»â—¡â‹…âŠƒ(Amnts|Dir|Orig))
      â£(TryMoveâ—ŒÂ°.|â‹…âœ(âŠ¢Amnts)+â‚â‹…Â°0_0))

    Â°1â‰¥/+âŠ¸Move!âŠƒAmnts Num
  )

  ClickSquare â† |3.2 â£(
    # If a move hasn't been started yet
    Â°Uninit :
    # Check if the square is occupied
    âŠ¡â—¡âŠ™Board~State
    # If empty, start a place
    # Otherwise, check that the active player
    # controls this square and start a move
    â£(Move 1 0_0 [] â©Â°1Â±â—‡âŠ¢|ClickSquareâ¤™Placeâ‹…0)
  | SwitchPlacement
  | PickUpPieces
  | MovePieces
  | # If nothing else works, restart the move and try again
    â¨¬(ClickSquareâŠ™â‹…Uninit)â—Œ â‰UninitâŠ¸:
  )
â””â”€â•´

# Transform board state based on a move
â”Œâ”€â•´Process
  # Process a placement
  ProcessPlace â† Move!(
    Place!âŠƒPos Piece
    ËœâŒŸâœ(Â°â–¡âŠ¡âŠ™Board~State)âŠ‚
  )
  # Process a movement
  ProcessMove â† Move~Move!âŸœâ†“(
    âŠƒNum Orig
    âœâŠ™âŠ™(Â°â–¡âŠ¡|Board~State)âŠƒâ†™â†˜
  | âŠƒ(â‡ŒAmnts|Â¤Dir|Orig)
    âˆ§(âŠƒâ†˜â†™Â¯âŠ™:âŠ™+
      âŠƒâ‹…â‹…âˆ˜âŠ™âœâŠ™(Â°â–¡âŠ¡âŠ™Board~State)âŠ‚)
    â‹…â—Œ
    # Flatten walls
    âœBoard~Stateâšâ‚€âœ(âŒµâ†˜â‚)â†§â‚
  )
  # Assert that a move is completely formed
  Validate â† Â°1âŠ¸â£(=/+Move~Move!âŠƒAmnts Num)1
  Call â† (
    Validate
    âŠƒâ£ProcessPlace ProcessMoveâ‹…Board~State
    âœBoard~HistoryâŠ‚
  )
â””â”€â•´

# Board 5

# âœ(Â°â–¡ âŠ¡1_2 Board~State|â‹…[Cap Flat Â¯Flat])
# âœ(Â°â–¡ âŠ¡3_2 Board~State|â‹…[Â¯Wall])

# Move
# ClickSquare 1_1
# Process

# Move
# [
#   1_2
#   1_2
#   1_2
#   2_2
#   2_2
#   3_2
# ]
# âˆ§ClickSquare
# Process
